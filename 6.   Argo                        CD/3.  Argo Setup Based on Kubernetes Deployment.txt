
3. Argo Setup Based on Kubernetes Deployment:
==============================================

1. Requirements:
-----------------
. Installed kubectl command-line tool.
. Have a kubeconfig file (default location is ~/.kube/config).
. CoreDNS. Can be enabled for microk8s by microk8s enable dns && microk8s stop && microk8s start.




2. Install Argo CD:
-----------------------
- This will create a new namespace, argocd, where Argo CD services and application resources will live.

# kubectl create namespace argocd
# kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml


- The installation manifests include ClusterRoleBinding resources that reference argocd namespace. 
- If you are installing Argo CD into a different namespace then make sure to update the namespace reference


- If you are not interested in UI, SSO, multi-cluster features then you can install core Argo CD components only:

# kubectl create namespace argocd
# kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/core-install.yaml




3. Download Argo CD CLI:
------------------------------
- You can download the latest Argo CD version from the latest release page of this repository, which will include the argocd CLI.

# https://github.com/argoproj/argo-cd/releases/latest

# pacman -S argocd
# curl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64
# sudo install -m 555 argocd-linux-amd64 /usr/local/bin/argocd
# rm argocd-linux-amd64

- You should now be able to run argocd commands.




4. Access The Argo CD API Server:
-----------------------------------
- By default, the Argo CD API server is not exposed with an external IP. To access the API server, choose one of the following techniques 
  to expose the Argo CD API server:

- Service Type Load Balancer:
------------------------------
. Change the argocd-server service type to LoadBalancer:

# kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'

- Port Forwarding:
--------------------
. Kubectl port-forwarding can also be used to connect to the API server without exposing the service.

# kubectl port-forward svc/argocd-server -n argocd 8080:443

. The API server can then be accessed using https://localhost:8080




5. Login Using The CLI:
-----------------------------
- The initial password for the admin account is auto-generated and stored as clear text in the field password in a secret named 
  argocd-initial-admin-secret in your Argo CD installation namespace. You can simply retrieve this password using the argocd CLI:

# argocd admin initial-password -n argocd

- Using the username admin and the password from above, login to Argo CD's IP or hostname:

# argocd login <ARGOCD_SERVER>

- Change the password using the command:

# argocd account update-password

